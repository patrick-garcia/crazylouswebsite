<?php include 'private/albumsprocess.php'; ?>


<div class="cart card" <?= cartShow() ?> >
  <div class="card-header">
    <h5 class="font-weight-light">items on cart: 
      <span class="font-weight-bold">
        <?=  isset($_SESSION['orderalbumID']) ? count($_SESSION['orderalbumID']) : '' ?>
      </span>
    </h5>
  </div>
  <div class="card-body">
    <a href="albums.php?clearcart" class="mr-2 btn btn-sm btn-outline-primary">clear</a>
    <a href="order.php" class="btn btn-sm btn-success">order</a>
  </div>
</div> <!-- end of cart -->

<div class="container text-secondary container-min-height" id="albums-container">
  <div class="row sort-filter">
    <?php
      global $con;
      moreResCheck($con);
      $sqlCat = "CALL category_load()";
      $category = $con->query($sqlCat) or die($con->error);
    ?>
    <div class="col-md-12">
      <form action="" method="POST">
        <div class="row">
          <div class="form-group col-md-4">
            <h5 class="pl-2 font-weight-light">category:</h5>
            <select name="category" class="form-control form-control-lg">
              <?php while($category_row = $category->fetch_assoc()): ?>
                <option value="<?= $category_row['categoryid']; ?>" <?= ($catval == $category_row['categoryid']) ? 'selected' : '' ?> ><?= $category_row['categoryname']; ?></option>
              <?php endwhile; ?>
            </select>
          </div>
          <div class="form-group col-md-2">
            <h5 class="pl-2 font-weight-light">sort by:</h5>
            <select name="sortby" class="form-control form-control-lg">
              <option value="album" <?= ($sortby == 'album') ? 'selected' : '' ?> >album</option>
              <option value="artist" <?= ($sortby == 'artist') ? 'selected' : '' ?> >artist</option>
            </select>
          </div>
          <div class="form-group col-md-1">
            <button type="submit" name="sortsubmit" class="btn btn-outline-primary">sort</button>
          </div>
        </div>
      </form>
    </div>
  </div> <!-- end of sort filter row -->

  <div class="row">
  <?php
    global $con;
    moreResCheck($con);
    $sqlSort = $catval == 6 ? showAllCategory($sortby) : showSelectedCat($sortby, $catval);
    $albums = $con->query($sqlSort) or die($con->error); ?>
    
  <?php while($albums_row = $albums->fetch_assoc()): ?>
  <div class="card col-md-4">
    <div class="card-body album-card box-shadow rounded">
      <div class="card-header box-shadow">
        <h4 class="text-secondary <?= ($sortby == 'album') ? '' : 'font-weight-light' ?> "><?= $albums_row['albumname'] ?></h4>
        
        <?php
          $artistid = $albums_row['artistgroupid'];
          global $con;
          moreResCheck($con);
          $sqlArtist = "CALL album_get_artist($artistid)";
          $name = $con->query($sqlArtist);
          $name_row = $name->fetch_assoc();
        ?>
        <h6 class="card-text text-secondary <?= ($sortby == 'artist') ? 'font-weight-bold font-italic' : '' ?>"><?= $name_row['artistgroupname']; ?></h6>
      </div> <!-- end of card-header -->
      
      <?php
        $tracklistid = $albums_row['tracklistid'];
        global $con;
        moreResCheck($con);
        $sqlTracks = "CALL album_get_tracks($tracklistid)";
        $tracks = $con->query($sqlTracks);
      ?>
      <div class="card-body">
        <ul class="list-group list-group-flush">
        <?php while($tracks_row = $tracks->fetch_assoc()): ?>
          <li class="list-group-item text-secondary">
            <?= $tracks_row['trackname']; ?>
          </li>
        <?php endwhile; ?>
        </ul>
      </div>
      <a href="albums.php?getalbumID=<?= $albums_row['albumid'] ?>" class="btn btn-sm btn-primary box-shadow">add to cart</a>
    </div> <!-- end of card-body album-card -->
  </div> <!-- end of card -->
  <?php endwhile; ?>

  </div> <!-- end of row -->
</div> <!-- end of container -->